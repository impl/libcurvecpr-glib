language: c
before_install:
    - sudo apt-get update -qq
    - sudo apt-get install -qq check
    - pushd /tmp
    - wget http://archive.ubuntu.com/ubuntu/pool/main/g/glib2.0/libglib2.0-0_2.34.0-1ubuntu1_amd64.deb
    - sudo dpkg -i libglib2.0-0_2.34.0-1ubuntu1_amd64.deb
    - wget http://download.dnscrypt.org/libsodium/releases/libsodium-0.4.2.tar.gz
    - tar xzf libsodium-0.4.2.tar.gz
    - pushd libsodium-0.4.2
    - ./configure
    - make
    - sudo make install
    - popd
    - popd
    - sudo ldconfig
env:
    - USE_LIBGLIB=no
    - USE_LIBGLIB=yes
before_script:
    - ./autogen.sh
    - sh -c 'if [ "$USE_LIBGLIB" = "yes" ]; then ./configure --with-libglib CFLAGS="-Werror"; fi'
    - sh -c 'if [ "$USE_LIBGLIB" = "no" ]; then ./configure --without-libglib CFLAGS="-Werror"; fi'
script: make check
compiler:
    - clang
    - gcc
